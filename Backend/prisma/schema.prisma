generator client {
  provider = "prisma-client-js"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model persona {
  id        Int      @id @default(autoincrement())
  mail     String   @unique
  nombre  String
  contrasenia  String
  usuario  String   @unique

  archivos        archivos[]
  mensajes        mensajes[]
  tareas          tareas[]
  personalizaciones personalizaciones[]
  proyectos_tiene tiene[]
  chat_tiene tiene_pc[]
  leido_mensajes     leido[] 

  googleRefreshToken String?
}

model archivos {
  formato  String
  archivo   Bytes
  nombrearchivo   String
  id    Int     @id @default(autoincrement())
  id_persona  Int
  id_proyecto   Int

  persona       persona  @relation(fields: [id_persona], references: [id])
  proyecto      proyecto @relation(fields: [id_proyecto], references: [id])

}

model mensajes {
  id_chat   Int
  id_persona    Int
  mensaje   String
  estado    String
  id    Int     @id @default(autoincrement())

  chat          chat     @relation(fields: [id_chat], references: [id])
  persona       persona  @relation(fields: [id_persona], references: [id])
  leidopor leido[]
}

model tareas {
  nombre    String
  estado    String
  id    Int    @id @default(autoincrement())
  id_proyecto   Int
  id_persona    Int
  limite      String

  proyecto      proyecto @relation(fields: [id_proyecto], references: [id])
  persona       persona  @relation(fields: [id_persona], references: [id])
}

model personalizaciones {
  id    Int     @id @default(autoincrement())
  id_persona    Int
  codigo_a_insertar   String

  persona             persona  @relation(fields: [id_persona], references: [id])
}

model tiene {
  id        Int      @id @default(autoincrement())
  id_persona  Int 
  id_proyecto   Int

  persona       persona  @relation(fields: [id_persona], references: [id])
  proyecto      proyecto @relation(fields: [id_proyecto], references: [id])
}

model proyecto {
  id        Int      @id @default(autoincrement())
  nombre     String   
  limite     String

  archivos        archivos[]
  tareas          tareas[]
  chat_tiene tiene_rc[]
  personas_tiene  tiene[]
  chats           chat[]
}

model chat {
  id        Int      @id @default(autoincrement())
  nombre     String   

  id_proyecto   Int
  proyecto      proyecto @relation(fields: [id_proyecto], references: [id])
  mensajes      mensajes[]
  personas_tiene  tiene_pc[]
  proyectos_tiene tiene_rc[]
}

model tiene_pc {
  id         Int      @id @default(autoincrement())
  id_persona Int
  id_chat    Int
  
  persona    persona  @relation(fields: [id_persona], references: [id])
  chat       chat     @relation(fields: [id_chat], references: [id])
}

model tiene_rc {
  id          Int      @id @default(autoincrement())
  id_proyecto Int
  id_chat     Int
  
  proyecto    proyecto @relation(fields: [id_proyecto], references: [id])
  chat        chat     @relation(fields: [id_chat], references: [id])
}

//
model leido {
  id Int @id @default(autoincrement())
  id_mensaje Int
  id_persona Int

  mensaje mensajes @relation(fields: [id_mensaje], references: [id])
  persona persona @relation(fields: [id_persona], references: [id])
  @@unique([id_mensaje, id_persona])
}